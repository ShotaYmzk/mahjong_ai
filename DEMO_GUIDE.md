# 10,000ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¢å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€10,000ã‚²ãƒ¼ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦æ•™å¸«ã‚ã‚Šå­¦ç¿’ã®ãƒ‡ãƒ¢ã‚’å®Ÿè¡Œã™ã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ å®Ÿè¡Œæ‰‹é †ï¼ˆæ‰€è¦æ™‚é–“: ç´„2-3æ™‚é–“ï¼‰

### å‰ææ¡ä»¶

```bash
cd /home/ubuntu/Documents/mahjong_ai
pip install -r requirements.txt
pip install tqdm  # ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤ºç”¨
```

---

## ã‚¹ãƒ†ãƒƒãƒ—1: XMLãƒ‡ãƒ¼ã‚¿ã®åé›†ï¼ˆç´„30åˆ†ï¼‰

å¤©é³³ã®XMLãƒ­ã‚°ã‚’10,000ã‚²ãƒ¼ãƒ åé›†ã—ã¾ã™ã€‚

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: ãƒ‡ãƒ¼ã‚¿åé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```bash
# å¤©é³³ã®HTMLã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‹ã‚‰10,000ã‚²ãƒ¼ãƒ åé›†
python scripts/collect_tenhou_data.py \
    --html-dir /home/ubuntu/Documents/tenhou_dataset \
    --xml-dir data/xml_logs \
    --years 2024 2023 \
    --game-type å››é³³ \
    --max-files 10000
```

**æ³¨æ„:** å¤©é³³ã®HTMLã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãŒå¿…è¦ã§ã™ã€‚ã¾ã ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ãªã„å ´åˆã¯ã€ä¸‹è¨˜ã‚’å‚ç…§ï¼š
- [å¤©é³³ç‰Œè­œã‚¢ãƒ¼ã‚«ã‚¤ãƒ–](http://tenhou.net/sc/raw/)

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: æ—¢å­˜ã®XMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨

æ—¢ã«XMLãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€`data/xml_logs/` ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚

```bash
# ç¢ºèª
ls data/xml_logs/*.xml | wc -l
# å‡ºåŠ›: 10000 ä»¥ä¸Šã§ã‚ã‚Œã°OK
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³C: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§å°è¦æ¨¡ãƒ†ã‚¹ãƒˆ

ã¾ãš1ã‚²ãƒ¼ãƒ ã§ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆï¼š

```bash
# ã‚µãƒ³ãƒ—ãƒ«XMLã‚’ã‚³ãƒ”ãƒ¼
mkdir -p data/xml_logs
cp 2009080100gm-00e1-0000-63d644dd.xml data/xml_logs/
```

---

## ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ§‹ç¯‰ï¼ˆç´„1-2æ™‚é–“ï¼‰

XMLãƒ­ã‚°ã‚’å›ºå®šé•·ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆ2,099æ¬¡å…ƒï¼‰ã«å¤‰æ›ã—ã¾ã™ã€‚

### åŸºæœ¬å®Ÿè¡Œ

```bash
python scripts/build_comprehensive_dataset.py \
    --xml-dir data/xml_logs \
    --output-dir data/processed_demo \
    --max-games 10000 \
    --draw-history 8 \
    --discard-history 32 \
    --train-ratio 0.8 \
    --val-ratio 0.1 \
    --test-ratio 0.1
```

### è»½é‡ç‰ˆï¼ˆãƒ¡ãƒ¢ãƒªç¯€ç´„ã€ç‰¹å¾´é‡æ¬¡å…ƒæ•°å‰Šæ¸›ï¼‰

```bash
python scripts/build_comprehensive_dataset.py \
    --xml-dir data/xml_logs \
    --output-dir data/processed_demo_light \
    --max-games 10000 \
    --draw-history 4 \
    --discard-history 16
```

**å‡¦ç†æ™‚é–“ã®ç›®å®‰:**
- 100ã‚²ãƒ¼ãƒ : 1-2åˆ†
- 1,000ã‚²ãƒ¼ãƒ : 10-20åˆ†
- 10,000ã‚²ãƒ¼ãƒ : 1-2æ™‚é–“

### å‡ºåŠ›ç¢ºèª

å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
data/processed_demo/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ X_train.npy          # è¨“ç·´ãƒ‡ãƒ¼ã‚¿ç‰¹å¾´é‡
â”‚   â”œâ”€â”€ y_train.npy          # è¨“ç·´ãƒ‡ãƒ¼ã‚¿ãƒ©ãƒ™ãƒ«
â”‚   â””â”€â”€ metadata_train.json
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ X_val.npy
â”‚   â”œâ”€â”€ y_val.npy
â”‚   â””â”€â”€ metadata_val.json
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ X_test.npy
â”‚   â”œâ”€â”€ y_test.npy
â”‚   â””â”€â”€ metadata_test.json
â””â”€â”€ dataset_info.json        # çµ±è¨ˆæƒ…å ±
```

çµ±è¨ˆæƒ…å ±ã‚’ç¢ºèªï¼š

```bash
cat data/processed_demo/dataset_info.json | python -m json.tool | head -30
```

---

## ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ï¼ˆç´„30åˆ†-1æ™‚é–“ï¼‰

å¤‰æ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã§Transformerãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã—ã¾ã™ã€‚

### ãƒ‡ãƒ¢ç”¨å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ

```bash
python scripts/train_demo.py \
    --data-dir data/processed_demo \
    --output-dir outputs/demo \
    --epochs 50 \
    --batch-size 256 \
    --learning-rate 1e-4
```

### å­¦ç¿’ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å­¦ç¿’çŠ¶æ³ã‚’ç¢ºèªï¼š

```bash
# ãƒ­ã‚°ã‚’è¡¨ç¤º
tail -f outputs/demo/train.log

# TensorBoardï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
tensorboard --logdir outputs/demo/tensorboard
```

### å­¦ç¿’å®Œäº†å¾Œ

å­¦ç¿’ãŒå®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
outputs/demo/
â”œâ”€â”€ checkpoints/
â”‚   â”œâ”€â”€ best_model.pt        # æœ€è‰¯ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ checkpoint_epoch_10.pt
â”‚   â”œâ”€â”€ checkpoint_epoch_20.pt
â”‚   â””â”€â”€ ...
â”œâ”€â”€ logs/
â”‚   â””â”€â”€ train.log
â””â”€â”€ metrics/
    â”œâ”€â”€ train_metrics.json
    â””â”€â”€ val_metrics.json
```

---

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰

ã¾ãšå°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆï¼š

```bash
# ã‚¹ãƒ†ãƒƒãƒ—1: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
mkdir -p data/xml_logs
cp 2009080100gm-00e1-0000-63d644dd.xml data/xml_logs/

# ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ§‹ç¯‰ï¼ˆ1ã‚²ãƒ¼ãƒ ï¼‰
python scripts/build_comprehensive_dataset.py \
    --xml-dir data/xml_logs \
    --output-dir data/processed_test \
    --max-games 1

# ã‚¹ãƒ†ãƒƒãƒ—3: å­¦ç¿’ï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰
python scripts/train_demo.py \
    --data-dir data/processed_test \
    --output-dir outputs/test \
    --epochs 5 \
    --batch-size 32
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1. XMLãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
# XMLãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
ls -lh data/xml_logs/*.xml | head

# ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã®ç¢ºèª
ls data/xml_logs/*.xml | wc -l
```

### 2. ãƒ¡ãƒ¢ãƒªä¸è¶³

ãƒ¡ãƒ¢ãƒªãŒä¸è¶³ã™ã‚‹å ´åˆã¯ã€ç‰¹å¾´é‡æ¬¡å…ƒæ•°ã‚’æ¸›ã‚‰ã™ã‹ã€ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¾ã™ï¼š

```bash
# è»½é‡è¨­å®š
python scripts/build_comprehensive_dataset.py \
    --draw-history 4 \
    --discard-history 16 \
    --max-games 5000

# å­¦ç¿’æ™‚ã®ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™
python scripts/train_demo.py --batch-size 128
```

### 3. å‡¦ç†ãŒé…ã„

```bash
# ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã§é€²æ—ç¢ºèª
python scripts/build_comprehensive_dataset.py --max-games 10000
# Ctrl+C ã§ä¸­æ–­å¯èƒ½ï¼ˆé€”ä¸­ã¾ã§å‡¦ç†ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ï¼‰
```

### 4. CUDAï¼ˆGPUï¼‰ãŒä½¿ãˆãªã„

GPUãŒç„¡ã„å ´åˆã§ã‚‚å­¦ç¿’å¯èƒ½ã§ã™ãŒã€æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼š

```bash
# CPU ã§ã®å­¦ç¿’
python scripts/train_demo.py --device cpu --epochs 20
```

---

## æœŸå¾…ã•ã‚Œã‚‹çµæœ

### ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆçµ±è¨ˆï¼ˆ10,000ã‚²ãƒ¼ãƒ ï¼‰

- ç·ã‚µãƒ³ãƒ—ãƒ«æ•°: ç´„500,000-600,000
- è¨“ç·´ãƒ‡ãƒ¼ã‚¿: ç´„400,000-500,000
- æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿: ç´„50,000-60,000
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: ç´„50,000-60,000
- ç‰¹å¾´é‡æ¬¡å…ƒ: 2,099ï¼ˆæ¨™æº–è¨­å®šï¼‰

### å­¦ç¿’çµæœï¼ˆ50ã‚¨ãƒãƒƒã‚¯ï¼‰

- è¨“ç·´ç²¾åº¦: 35-45%
- æ¤œè¨¼ç²¾åº¦: 33-42%
- Top-3ç²¾åº¦: 60-70%
- æå¤±: 2.0-2.5

**æ³¨æ„:** éº»é›€ã®æ‰“ç‰Œé¸æŠã¯é«˜åº¦ãªæˆ¦ç•¥æ€§ã‚’æŒã¤ãŸã‚ã€å®Œç’§ãªäºˆæ¸¬ã¯å›°é›£ã§ã™ã€‚ä¸Šç´šè€…ã§ã‚‚ä¸€è‡´ç‡ã¯40-50%ç¨‹åº¦ã§ã™ã€‚

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. ã‚ˆã‚Šå¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

```bash
# 50,000ã‚²ãƒ¼ãƒ ã§å­¦ç¿’
python scripts/build_comprehensive_dataset.py --max-games 50000
python scripts/train_demo.py --epochs 100
```

### 2. ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´

```bash
# å­¦ç¿’ç‡ã®èª¿æ•´
python scripts/train_demo.py --learning-rate 5e-4

# ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºã®èª¿æ•´
python scripts/train_demo.py --d-model 512 --num-layers 8
```

### 3. è©•ä¾¡ã¨åˆ†æ

```bash
# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ã®è©•ä¾¡
python scripts/evaluate_model.py \
    --model outputs/demo/checkpoints/best_model.pt \
    --data-dir data/processed_demo
```

---

## ã‚ˆãã‚ã‚‹è³ªå•

### Q1: å‡¦ç†æ™‚é–“ã¯ã©ã®ãã‚‰ã„ï¼Ÿ

**A:** 8ã‚³ã‚¢CPUã€32GB RAMã®ç’°å¢ƒã§ã®ç›®å®‰ï¼š
- ãƒ‡ãƒ¼ã‚¿åé›†: 30åˆ†ï¼ˆ10,000ã‚²ãƒ¼ãƒ ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ§‹ç¯‰: 1-2æ™‚é–“ï¼ˆ10,000ã‚²ãƒ¼ãƒ ï¼‰
- ãƒ¢ãƒ‡ãƒ«å­¦ç¿’: 30åˆ†-1æ™‚é–“ï¼ˆ50ã‚¨ãƒãƒƒã‚¯ã€GPUä½¿ç”¨ï¼‰

### Q2: ã©ã®ãã‚‰ã„ã®ãƒ¡ãƒ¢ãƒªãŒå¿…è¦ï¼Ÿ

**A:** 10,000ã‚²ãƒ¼ãƒ ã®å ´åˆï¼š
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ§‹ç¯‰: 4-8 GB
- ãƒ¢ãƒ‡ãƒ«å­¦ç¿’: 2-4 GBï¼ˆGPU VRAMå«ã‚€ï¼‰

### Q3: GPUã¯å¿…é ˆï¼Ÿ

**A:** å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€GPUãŒã‚ã‚‹ã¨å­¦ç¿’ãŒ10-20å€é«˜é€Ÿã«ãªã‚Šã¾ã™ã€‚

### Q4: ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã¯ï¼Ÿ

**A:** ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```bash
# ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ§‹ç¯‰ã®ãƒ­ã‚°
cat dataset_building.log

# å­¦ç¿’ã®ãƒ­ã‚°
cat outputs/demo/train.log
```

---

## ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆï¼š
1. [ä½¿ç”¨ã‚¬ã‚¤ãƒ‰](docs/USAGE_GUIDE.md) ã‚’ç¢ºèª
2. [ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ](scripts/test_data_pipeline.py) ã‚’å®Ÿè¡Œ
3. GitHubã§Issueã‚’ä½œæˆ

**Happy Training! ğŸš€ğŸ€„**

