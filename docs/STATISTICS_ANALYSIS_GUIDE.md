# 麻雀統計分析ツール 使い方ガイド

## 概要

このツールは、天鳳の麻雀ゲームログ（XML形式）から詳細な統計を計算します。

## 機能

以下の指標を計算できます：

### 総合的な指標
- **平均順位（平均着順）**: 対局結果の平均順位。4人麻雀で2.50が基準
- **和了率（アガリ率）**: 自分が和了した局の割合
- **放銃率（振り込み率）**: 他家に放銃した局の割合
- **和了率 - 放銃率**: 差分が10%以上が上級者の目安

### プレイスタイルに関する指標
- **副露率（鳴き率）**: 副露を使った局の割合
- **副露成功率**: 副露から和了に至った割合
- **リーチ率**: リーチをかけた局の割合
- **ダマ和了率**: ダマテンから和了に至った割合

### その他の指標
- **平均打点**: 1回あたりの和了で獲得する平均点数
- **平均放銃点**: 1回あたりの放銃で失う平均点数
- **流局聴牌率**: 流局した際に聴牌していた割合

## 使い方

### 基本的な使用方法

```bash
python scripts/analyze_game_statistics.py <XMLディレクトリ>
```

### オプション

| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `--max-files` | 解析する最大ファイル数 | すべて |
| `--top-n` | 表示する上位プレイヤー数 | 20 |
| `--csv-output` | CSV出力先ファイルパス | なし（出力しない） |
| `--min-games` | 最小ゲーム数（フィルタ用） | 10 |

### 実行例

#### 例1: 基本的な実行（最初の1000ファイルを分析）

```bash
cd /home/ubuntu/Documents/mahjong_ai
python scripts/analyze_game_statistics.py /home/ubuntu/Documents/tenhou_xml_2023 --max-files 1000
```

#### 例2: トップ50プレイヤーを表示

```bash
python scripts/analyze_game_statistics.py /home/ubuntu/Documents/tenhou_xml_2023 \
  --max-files 5000 \
  --top-n 50
```

#### 例3: CSV出力を有効にして、20ゲーム以上のプレイヤーを分析

```bash
python scripts/analyze_game_statistics.py /home/ubuntu/Documents/tenhou_xml_2023 \
  --max-files 10000 \
  --csv-output outputs/statistics.csv \
  --min-games 20
```

#### 例4: 全ファイルを分析（時間がかかります）

```bash
python scripts/analyze_game_statistics.py /home/ubuntu/Documents/tenhou_xml_2023 \
  --top-n 100 \
  --csv-output outputs/full_statistics.csv \
  --min-games 50
```

## 出力例

### コンソール出力

```
====================================================================================================
麻雀ゲームログ統計分析
====================================================================================================

総ゲーム数: 10000
分析プレイヤー数: 2177

※ 10ゲーム以上プレイしたプレイヤーのみ表示
該当プレイヤー数: 1147

====================================================================================================
トップ30プレイヤー（平均順位順）
====================================================================================================
順位   プレイヤー名               平均順位     和了率      放銃率      差分       総ゲーム    
----------------------------------------------------------------------------------------------------
1    子衿雅歌                 1.400    32.43    12.61    19.82    10      
2    CHUGE                1.462    31.82    10.61    21.21    13      
...

====================================================================================================
詳細統計（トップ3プレイヤー）
====================================================================================================

第1位: 子衿雅歌
----------------------------------------------------------------------------------------------------
  【総合指標】
    平均順位: 1.400
    和了率: 32.43%
    放銃率: 12.61%
    和了率-放銃率: 19.82%
  【プレイスタイル】
    副露率: 41.44%
    副露成功率: 34.78%
    リーチ率: 18.92%
    ダマ和了率: 63.89%
  【その他】
    平均打点: 6067点
    平均放銃点: 5029点
    流局聴牌率: 50.00%
...
```

### CSV出力

CSV形式で全プレイヤーのデータが出力されます：

```csv
プレイヤー名,平均順位,和了率,放銃率,和了率-放銃率,副露率,副露成功率,リーチ率,ダマ和了率,平均打点,平均放銃点,流局聴牌率,総ゲーム数,総局数,和了回数,放銃回数
子衿雅歌,1.400,32.43,12.61,19.82,41.44,34.78,18.92,63.89,6067,5029,50.00,10,111,36,14
...
```

## 統計指標の解釈

### 平均順位
- **2.50**: 平均的
- **2.00以下**: 優秀
- **1.80以下**: 非常に優秀

### 和了率
- **20-25%**: 平均的
- **25%以上**: 優秀
- **30%以上**: 非常に優秀

### 放銃率
- **12-15%**: 平均的
- **10%以下**: 優秀（守備力が高い）
- **15%以上**: 要改善

### 和了率-放銃率
- **5-10%**: 平均的
- **10-15%**: 優秀
- **15%以上**: 非常に優秀（トップ層）

### 副露成功率
- **25-30%**: 平均的
- **30%以上**: 優秀（効率的な鳴き）
- **20%以下**: 要改善（無駄な鳴きが多い）

### 流局聴牌率
- **40-45%**: 平均的
- **50%以上**: 優秀（聴牌維持能力が高い）
- **35%以下**: 要改善

## パフォーマンス

| ファイル数 | 推定処理時間 |
|-----------|-------------|
| 1,000 | 約1分 |
| 5,000 | 約5分 |
| 10,000 | 約10分 |
| 20,000 | 約20分 |
| 194,369（全ファイル） | 約2-3時間 |

## トラブルシューティング

### メモリ不足エラー
大量のファイルを処理する場合、メモリ不足になることがあります。その場合は：
- `--max-files`を使ってファイル数を制限する
- バッチ処理で複数回に分けて実行する

### 処理が遅い
- プログレスメッセージ（100ファイルごと）で進捗を確認できます
- 処理を中断する場合は Ctrl+C

## 次のステップ

1. **少数のファイルでテスト**: まず1000ファイル程度で試す
2. **結果を確認**: 統計指標が正しく計算されているか確認
3. **大規模データで実行**: 10000ファイル以上で本格的な分析
4. **CSV出力を活用**: Excelやスプレッドシートで詳細分析

## 関連ファイル

- **スクリプト**: `scripts/analyze_game_statistics.py`
- **出力ディレクトリ**: `outputs/`
- **サマリー**: `outputs/analysis_summary.md`

